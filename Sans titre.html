<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Tracker Pro</title>
    
    <!-- React & ReactDOM (Versions Development pour meilleurs logs d'erreurs, changer en prod pour dÃ©ploiement) -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel Standalone (Version 7 - Plus stable) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Utilitaire pour le Stockage SÃ©curisÃ© (Ã‰vite les plantages "Script Error" si localStorage bloquÃ©) ---
        const safeStorage = {
            getItem: (key) => {
                try {
                    return localStorage.getItem(key);
                } catch (e) {
                    console.warn("AccÃ¨s localStorage bloquÃ© ou indisponible", e);
                    return null;
                }
            },
            setItem: (key, value) => {
                try {
                    localStorage.setItem(key, value);
                } catch (e) {
                    console.warn("Ã‰criture localStorage impossible", e);
                }
            }
        };

        // --- IcÃ´nes (SVG intÃ©grÃ©s) ---
        const Icons = {
            Activity: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>,
            Settings: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
            ClipboardCopy: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/></svg>,
            Sun: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>,
            Moon: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>,
            Coffee: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" x2="6" y1="1" y2="4"/><line x1="10" x2="10" y1="1" y2="4"/><line x1="14" x2="14" y1="1" y2="4"/></svg>,
            CheckCircle2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
            AlertCircle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>,
            ChevronLeft: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 18 9 12 15 6"/></svg>,
            ChevronRight: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"/></svg>,
            PlusCircle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="16"/><line x1="8" x2="16" y1="12" y2="12"/></svg>,
            Trash2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
            Plus: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" x2="12" y1="5" y2="19"/><line x1="5" x2="19" y1="12" y2="12"/></svg>
        };

        // --- Composants UI de base ---

        const Card = ({ children, className = "" }) => (
            <div className={`bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden ${className}`}>
                {children}
            </div>
        );

        const Badge = ({ children, color = "slate" }) => {
            const colors = {
                slate: "bg-slate-100 text-slate-700",
                green: "bg-emerald-100 text-emerald-700",
                red: "bg-rose-100 text-rose-700",
                blue: "bg-blue-100 text-blue-700",
                indigo: "bg-indigo-100 text-indigo-700",
                amber: "bg-amber-100 text-amber-700",
            };
            return (
                <span className={`px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wide ${colors[color] || colors.slate}`}>
                    {children}
                </span>
            );
        };

        // --- DonnÃ©es et Constantes ---

        const DEFAULT_SUPPLEMENTS = [
            { id: 't4', name: 'LÃ©vothyrox', dosage: '100 Âµg', time: 'matin' },
            { id: 'glu', name: 'L-Glutamine', dosage: '5g', time: 'matin' },
            { id: 'multi', name: 'Multivitamines', dosage: '1 gÃ©lule', time: 'midi' },
            { id: 'o3', name: 'OmÃ©ga-3', dosage: '1000 mg', time: 'midi' },
            { id: 'mg', name: 'MagnÃ©sium', dosage: '300 mg', time: 'soir' },
            { id: 'ash', name: 'Ashwagandha', dosage: 'KSM-66', time: 'soir' },
        ];

        const DAYS = ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi', 'Dimanche'];

        const INITIAL_DAY_DATA = {
            supplements: {}, 
            repasOk: { matin: false, midi: false, soir: false },
            metrics: { energie: '', moral: '', digestion: '', selles: '' },
            notes: ''
        };

        // Fonction utilitaire pour gÃ©nÃ©rer des dates lisibles
        const getWeekDates = (offsetWeeks = 0) => {
            const today = new Date();
            const first = today.getDate() - today.getDay() + 1 + (offsetWeeks * 7);
            const start = new Date(today.setDate(first));
            const end = new Date(today.setDate(first + 6));
            return {
                startStr: start.toLocaleDateString('fr-FR'),
                endStr: end.toLocaleDateString('fr-FR'),
                id: start.toISOString().split('T')[0] 
            };
        };

        function App() {
            // --- Ã‰tats (State) ---
            const [activeTab, setActiveTab] = useState('tracker'); 

            // 1. Configuration des complÃ©ments (Global)
            const [configSupplements, setConfigSupplements] = useState(() => {
                const saved = safeStorage.getItem('sante_config_supplements_v2');
                return saved ? JSON.parse(saved) : DEFAULT_SUPPLEMENTS;
            });

            // 2. Liste des semaines disponibles (MÃ©ta-donnÃ©es)
            const [weeksList, setWeeksList] = useState(() => {
                const saved = safeStorage.getItem('sante_weeks_list');
                if (saved) return JSON.parse(saved);
                // Initialisation avec la semaine courante si vide
                const current = getWeekDates();
                return [{ id: current.id, label: `Semaine du ${current.startStr} au ${current.endStr}`, objective: "Stabiliser la digestion" }];
            });

            // 3. ID de la semaine active
            const [activeWeekId, setActiveWeekId] = useState(() => {
                const savedList = safeStorage.getItem('sante_weeks_list');
                if (savedList) {
                    const list = JSON.parse(savedList);
                    if (list.length > 0) {
                        return list[list.length - 1].id; 
                    }
                }
                return getWeekDates().id;
            });

            // 4. DonnÃ©es de TOUTES les semaines (Big Data Object)
            const [allWeeksData, setAllWeeksData] = useState(() => {
                const saved = safeStorage.getItem('sante_all_weeks_data');
                if (saved) return JSON.parse(saved);
                
                // Migration ou Init
                const current = getWeekDates();
                const initialWeek = {};
                DAYS.forEach(day => { initialWeek[day] = JSON.parse(JSON.stringify(INITIAL_DAY_DATA)); });
                
                return { [current.id]: { days: initialWeek, review: { victories: '', adjustments: '' } } };
            });

            // --- Sauvegarde automatique ---
            useEffect(() => {
                safeStorage.setItem('sante_config_supplements_v2', JSON.stringify(configSupplements));
                safeStorage.setItem('sante_weeks_list', JSON.stringify(weeksList));
                safeStorage.setItem('sante_all_weeks_data', JSON.stringify(allWeeksData));
            }, [configSupplements, weeksList, allWeeksData]);

            // --- Helpers pour la semaine active ---
            const currentWeekData = allWeeksData[activeWeekId] || { days: {}, review: {} };
            const currentWeekMeta = weeksList.find(w => w.id === activeWeekId) || weeksList[0];

            // --- Actions de Navigation (Semaines) ---

            const createNewWeek = () => {
                const lastWeekId = weeksList[weeksList.length - 1].id;
                const lastDate = new Date(lastWeekId);
                lastDate.setDate(lastDate.getDate() + 7); 
                
                const nextStart = lastDate;
                const nextEnd = new Date(lastDate);
                nextEnd.setDate(nextEnd.getDate() + 6);

                const newWeekId = nextStart.toISOString().split('T')[0];
                const newWeekLabel = `Semaine du ${nextStart.toLocaleDateString('fr-FR')} au ${nextEnd.toLocaleDateString('fr-FR')}`;

                setWeeksList(prev => [...prev, { id: newWeekId, label: newWeekLabel, objective: '' }]);
                
                const emptyWeekData = {};
                DAYS.forEach(day => { emptyWeekData[day] = JSON.parse(JSON.stringify(INITIAL_DAY_DATA)); });
                setAllWeeksData(prev => ({
                    ...prev,
                    [newWeekId]: { days: emptyWeekData, review: { victories: '', adjustments: '' } }
                }));

                setActiveWeekId(newWeekId);
            };

            const deleteCurrentWeek = () => {
                if (weeksList.length <= 1) {
                    alert("Impossible de supprimer la seule semaine existante.");
                    return;
                }
                if(confirm("Es-tu sÃ»r de vouloir supprimer dÃ©finitivement cette semaine et ses donnÃ©es ?")) {
                    const newWeeksList = weeksList.filter(w => w.id !== activeWeekId);
                    const newAllData = { ...allWeeksData };
                    delete newAllData[activeWeekId];

                    setWeeksList(newWeeksList);
                    setAllWeeksData(newAllData);
                    setActiveWeekId(newWeeksList[newWeeksList.length - 1].id);
                }
            };

            const navigateWeek = (direction) => {
                const currentIndex = weeksList.findIndex(w => w.id === activeWeekId);
                if (direction === 'prev' && currentIndex > 0) {
                    setActiveWeekId(weeksList[currentIndex - 1].id);
                } else if (direction === 'next' && currentIndex < weeksList.length - 1) {
                    setActiveWeekId(weeksList[currentIndex + 1].id);
                }
            };

            // --- Actions de Modification des DonnÃ©es (Tracker) ---

            const updateDayData = (day, field, value, subField = null) => {
                setAllWeeksData(prev => {
                    const week = prev[activeWeekId] ? { ...prev[activeWeekId] } : { days: {}, review: {} };
                    const dayData = week.days[day] ? { ...week.days[day] } : JSON.parse(JSON.stringify(INITIAL_DAY_DATA));
                    
                    if (subField) {
                        dayData[field] = { ...dayData[field], [subField]: value };
                    } else {
                        dayData[field] = value;
                    }
                    
                    week.days[day] = dayData;
                    return { ...prev, [activeWeekId]: week };
                });
            };

            const toggleSupplement = (day, suppId) => {
                const currentVal = currentWeekData.days[day]?.supplements[suppId];
                updateDayData(day, 'supplements', !currentVal, suppId);
            };

            const toggleRepas = (day, time) => {
                const currentVal = currentWeekData.days[day]?.repasOk[time];
                updateDayData(day, 'repasOk', !currentVal, time);
            };

            const updateMetric = (day, metric, value) => updateDayData(day, 'metrics', value, metric);
            const updateNote = (day, value) => updateDayData(day, 'notes', value);

            const updateReview = (field, value) => {
                setAllWeeksData(prev => {
                    const week = { ...prev[activeWeekId] };
                    week.review = { ...week.review, [field]: value };
                    return { ...prev, [activeWeekId]: week };
                });
            };
            
            const updateObjective = (value) => {
                setWeeksList(prev => prev.map(w => w.id === activeWeekId ? { ...w, objective: value } : w));
            };

            // --- Actions de Configuration (Settings) ---

            const addSupplement = (name, dosage, time) => {
                const newSupp = { id: Date.now().toString(), name, dosage, time };
                setConfigSupplements([...configSupplements, newSupp]);
            };

            const removeSupplement = (id) => {
                setConfigSupplements(configSupplements.filter(s => s.id !== id));
            };

            const updateSupplementDosage = (id, newDosage) => {
                setConfigSupplements(prev => prev.map(s => s.id === id ? { ...s, dosage: newDosage } : s));
            };

            // --- Export IA ---
            const copyForAI = () => {
                let prompt = `Analyse mes donnÃ©es de santÃ© pour la ${currentWeekMeta.label}.\n`;
                prompt += `Objectif : ${currentWeekMeta.objective}\n\n`;
                
                DAYS.forEach(day => {
                    const data = currentWeekData.days[day] || INITIAL_DAY_DATA;
                    const suppsTaken = configSupplements
                        .filter(s => data.supplements[s.id])
                        .map(s => `${s.name} (${s.dosage})`)
                        .join(', ');
                    
                    const repasScore = Object.values(data.repasOk).filter(Boolean).length;
                    
                    prompt += `--- ${day.toUpperCase()} ---\n`;
                    prompt += `- ComplÃ©ments : ${suppsTaken || 'Aucun'}\n`;
                    prompt += `- Repas respectÃ©s : ${repasScore}/3\n`;
                    prompt += `- Ã‰nergie : ${data.metrics.energie}/10 | Moral : ${data.metrics.moral}/10 | Digestion : ${data.metrics.digestion}/10\n`;
                    prompt += `- Selles : Type ${data.metrics.selles}\n`;
                    if (data.notes) prompt += `- Notes : ${data.notes}\n`;
                    prompt += `\n`;
                });

                prompt += `Bilan Victoires : ${currentWeekData.review?.victories || ''}\n`;
                prompt += `Ajustements prÃ©vus : ${currentWeekData.review?.adjustments || ''}\n`;
                
                navigator.clipboard.writeText(prompt);
                alert("DonnÃ©es copiÃ©es !");
            };

            // --- Helpers UI ---
            const getMetricColor = (val, type) => {
                if (!val) return 'bg-white';
                const v = parseInt(val);
                if (type === 'selles') return (v >= 3 && v <= 4) ? 'bg-emerald-100 text-emerald-800' : 'bg-amber-100 text-amber-800';
                if (v >= 7) return 'bg-emerald-100 text-emerald-800';
                if (v >= 4) return 'bg-blue-50 text-blue-800';
                return 'bg-rose-100 text-rose-800';
            };

            const currentIndex = weeksList.findIndex(w => w.id === activeWeekId);

            return (
                <div className="min-h-screen bg-slate-50 pb-20 font-sans text-slate-800">
                    
                    {/* HEADER */}
                    <header className="bg-white border-b border-slate-200 sticky top-0 z-20 shadow-sm">
                        <div className="max-w-7xl mx-auto px-4 py-3">
                            
                            {/* Top Row: Title + Controls */}
                            <div className="flex justify-between items-center mb-4">
                                <div className="flex items-center gap-3">
                                    <div className="bg-indigo-600 p-2 rounded-lg text-white">
                                        <Icons.Activity size={24} />
                                    </div>
                                    <div className="hidden md:block">
                                        <h1 className="text-xl font-bold text-slate-900 leading-tight">Health Tracker Pro</h1>
                                        <p className="text-[10px] text-slate-500 uppercase tracking-wider font-bold">v2.0 Multi-Week</p>
                                    </div>
                                </div>
                                
                                <div className="flex gap-2">
                                    <button 
                                        onClick={() => setActiveTab('tracker')}
                                        className={`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${activeTab === 'tracker' ? 'bg-slate-800 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}
                                    >
                                        Journal
                                    </button>
                                    <button 
                                        onClick={() => setActiveTab('settings')}
                                        className={`px-3 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2 ${activeTab === 'settings' ? 'bg-slate-800 text-white' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}
                                    >
                                        <Icons.Settings size={16} /> <span className="hidden md:inline">Traitements</span>
                                    </button>
                                    <button 
                                        onClick={copyForAI}
                                        className="px-3 py-2 rounded-lg text-sm font-medium bg-indigo-50 text-indigo-700 hover:bg-indigo-100 border border-indigo-200 flex items-center gap-2"
                                        title="Copier pour l'IA"
                                    >
                                        <Icons.ClipboardCopy size={16} /> <span className="hidden md:inline">Export IA</span>
                                    </button>
                                </div>
                            </div>

                            {/* Bottom Row: Week Navigation */}
                            {activeTab === 'tracker' && (
                                <div className="flex items-center justify-between bg-slate-100 p-1 rounded-lg">
                                    <button 
                                        onClick={() => navigateWeek('prev')}
                                        disabled={currentIndex === 0}
                                        className={`p-2 rounded-md ${currentIndex === 0 ? 'text-slate-300' : 'text-slate-600 hover:bg-white shadow-sm'}`}
                                    >
                                        <Icons.ChevronLeft size={20} />
                                    </button>

                                    <div className="text-center">
                                        <h2 className="text-sm font-bold text-slate-800">{currentWeekMeta.label}</h2>
                                        <div className="flex items-center justify-center gap-1">
                                            <span className="text-[10px] text-slate-500 uppercase tracking-wide">Semaine {currentIndex + 1} / {weeksList.length}</span>
                                        </div>
                                    </div>

                                    <div className="flex gap-1">
                                        <button 
                                            onClick={() => navigateWeek('next')}
                                            disabled={currentIndex === weeksList.length - 1}
                                            className={`p-2 rounded-md ${currentIndex === weeksList.length - 1 ? 'text-slate-300' : 'text-slate-600 hover:bg-white shadow-sm'}`}
                                        >
                                            <Icons.ChevronRight size={20} />
                                        </button>
                                        <div className="w-px h-8 bg-slate-200 mx-1"></div>
                                        <button 
                                            onClick={createNewWeek}
                                            className="px-3 py-1 bg-indigo-600 text-white rounded-md text-xs font-bold hover:bg-indigo-700 flex items-center gap-1 shadow-sm"
                                        >
                                            <Icons.PlusCircle size={14} /> Nouvelle
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto px-4 py-6">
                        
                        {/* VIEW: SETTINGS */}
                        {activeTab === 'settings' && (
                            <div className="max-w-3xl mx-auto">
                                <Card className="p-6">
                                    <h2 className="text-lg font-bold mb-4 flex items-center gap-2 border-b pb-4">
                                        <Icons.Settings size={20} className="text-indigo-600"/>
                                        Configuration des Traitements
                                    </h2>
                                    <p className="text-sm text-slate-500 mb-6 bg-blue-50 p-3 rounded-lg border border-blue-100">
                                        ðŸ’¡ <strong>Astuce Dosage :</strong> Ajuste ici les dosages semaine aprÃ¨s semaine. Si tu changes le dosage ici, il s'affichera mis Ã  jour dans ton journal.
                                    </p>

                                    <div className="space-y-8">
                                        {['matin', 'midi', 'soir'].map(time => (
                                            <div key={time} className="relative">
                                                <h3 className="font-bold capitalize text-slate-800 mb-3 flex items-center gap-2 text-lg">
                                                    {time === 'matin' && <div className="p-1.5 bg-blue-100 rounded text-blue-600"><Icons.Coffee size={18}/></div>}
                                                    {time === 'midi' && <div className="p-1.5 bg-amber-100 rounded text-amber-600"><Icons.Sun size={18}/></div>}
                                                    {time === 'soir' && <div className="p-1.5 bg-indigo-100 rounded text-indigo-600"><Icons.Moon size={18}/></div>}
                                                    {time}
                                                </h3>
                                                
                                                <div className="space-y-3">
                                                    {configSupplements.filter(s => s.time === time).map(supp => (
                                                        <div key={supp.id} className="flex flex-col md:flex-row md:items-center gap-2 bg-slate-50 p-3 rounded-lg border border-slate-200 shadow-sm">
                                                            <div className="flex-1 font-medium text-slate-700">{supp.name}</div>
                                                            
                                                            <div className="flex items-center gap-2 w-full md:w-auto">
                                                                <label className="text-xs text-slate-400 uppercase font-bold">Dosage:</label>
                                                                <input 
                                                                    type="text" 
                                                                    value={supp.dosage || ''} 
                                                                    onChange={(e) => updateSupplementDosage(supp.id, e.target.value)}
                                                                    className="w-24 text-sm p-1.5 border border-slate-300 rounded focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 outline-none"
                                                                    placeholder="ex: 10mg"
                                                                />
                                                                <button 
                                                                    onClick={() => removeSupplement(supp.id)} 
                                                                    className="p-2 text-slate-400 hover:text-rose-500 hover:bg-rose-50 rounded transition-colors ml-1"
                                                                    title="Supprimer"
                                                                >
                                                                    <Icons.Trash2 size={16}/>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                                
                                                <form 
                                                    onSubmit={(e) => {
                                                        e.preventDefault();
                                                        const name = e.target.elements.name.value;
                                                        const dosage = e.target.elements.dosage.value;
                                                        if(name) { addSupplement(name, dosage, time); e.target.reset(); }
                                                    }}
                                                    className="mt-4 flex gap-2 items-center"
                                                >
                                                    <input name="name" placeholder="Nouveau traitement..." className="flex-grow text-sm p-2 border border-slate-300 rounded shadow-sm" required />
                                                    <input name="dosage" placeholder="Dosage" className="w-24 text-sm p-2 border border-slate-300 rounded shadow-sm" />
                                                    <button type="submit" className="bg-slate-800 text-white p-2 rounded shadow-sm hover:bg-slate-700 flex items-center gap-1 text-sm font-medium">
                                                        <Icons.Plus size={16}/> Ajouter
                                                    </button>
                                                </form>
                                            </div>
                                        ))}
                                    </div>
                                </Card>
                            </div>
                        )}

                        {/* VIEW: TRACKER */}
                        {activeTab === 'tracker' && (
                            <div className="space-y-6">
                                
                                {/* Objectif Bar */}
                                <div className="bg-white p-4 rounded-xl border border-indigo-100 shadow-sm flex flex-col md:flex-row gap-4 items-start md:items-center">
                                    <div className="flex-1 w-full">
                                        <label className="text-xs text-indigo-500 uppercase font-bold tracking-wider mb-1 block">Objectif de la semaine</label>
                                        <input 
                                            value={currentWeekMeta.objective} 
                                            onChange={(e) => updateObjective(e.target.value)} 
                                            className="block w-full text-lg font-medium text-slate-700 placeholder-slate-300 border-none outline-none bg-transparent focus:bg-slate-50 rounded px-1 -ml-1"
                                            placeholder="Ex: Maintenir le rÃ©gime SIBO strict..."
                                        />
                                    </div>
                                    <div className="hidden md:block w-px h-10 bg-slate-100"></div>
                                    <div className="text-right whitespace-nowrap">
                                        <div className="text-xs text-slate-400">Progression</div>
                                        <div className="font-bold text-slate-700">J{DAYS.indexOf(new Date().toLocaleDateString('fr-FR', {weekday: 'long'})) !== -1 ? DAYS.indexOf(new Date().toLocaleDateString('fr-FR', {weekday: 'long'})) + 1 : '-'} / 7</div>
                                    </div>
                                </div>

                                {/* Main Table */}
                                <Card className="overflow-x-auto">
                                    <table className="w-full text-sm text-left">
                                        <thead className="bg-slate-50 text-slate-500 uppercase text-xs font-bold border-b border-slate-200">
                                            <tr>
                                                <th className="px-4 py-3 min-w-[100px]">Jour</th>
                                                <th className="px-4 py-3 min-w-[180px] text-center bg-blue-50/50">Matin</th>
                                                <th className="px-4 py-3 min-w-[180px] text-center bg-amber-50/50">Midi</th>
                                                <th className="px-4 py-3 min-w-[180px] text-center bg-indigo-50/50">Soir</th>
                                                <th className="px-4 py-3 min-w-[250px] border-l border-slate-200">MÃ©triques (0-10)</th>
                                                <th className="px-4 py-3 min-w-[200px]">Notes</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-100">
                                            {DAYS.map((day) => {
                                                const data = currentWeekData.days[day] || INITIAL_DAY_DATA; 
                                                return (
                                                    <tr key={day} className="hover:bg-slate-50/80 transition-colors group">
                                                        
                                                        {/* Day Name */}
                                                        <td className="px-4 py-4 font-bold text-slate-700">{day}</td>
                                                        
                                                        {/* Matin */}
                                                        <td className="px-3 py-4 align-top bg-blue-50/20">
                                                            <div className="flex flex-col gap-3">
                                                                {configSupplements.filter(s => s.time === 'matin').map(supp => (
                                                                    <label key={supp.id} className="flex items-start gap-2 cursor-pointer select-none group/item">
                                                                        <input 
                                                                            type="checkbox" 
                                                                            checked={!!data.supplements[supp.id]} 
                                                                            onChange={() => toggleSupplement(day, supp.id)}
                                                                            className="mt-0.5 w-4 h-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500"
                                                                        />
                                                                        <div className="leading-tight">
                                                                            <div className={`text-xs ${data.supplements[supp.id] ? 'text-slate-800 font-medium' : 'text-slate-500'}`}>{supp.name}</div>
                                                                            <div className="text-[10px] text-slate-400 font-mono">{supp.dosage}</div>
                                                                        </div>
                                                                    </label>
                                                                ))}
                                                            </div>
                                                        </td>

                                                        {/* Midi */}
                                                        <td className="px-3 py-4 align-top bg-amber-50/20">
                                                            <div className="flex flex-col gap-3">
                                                                <label className="flex items-center gap-2 cursor-pointer select-none mb-1">
                                                                    <input 
                                                                        type="checkbox" 
                                                                        checked={data.repasOk.midi} 
                                                                        onChange={() => toggleRepas(day, 'midi')}
                                                                        className="w-4 h-4 rounded border-slate-300 text-emerald-600 focus:ring-emerald-500"
                                                                    />
                                                                    <Badge color={data.repasOk.midi ? 'green' : 'slate'}>Repas OK</Badge>
                                                                </label>
                                                                <div className="w-12 border-b border-slate-200 mx-auto opacity-50"></div>
                                                                {configSupplements.filter(s => s.time === 'midi').map(supp => (
                                                                    <label key={supp.id} className="flex items-start gap-2 cursor-pointer select-none group/item">
                                                                        <input 
                                                                            type="checkbox" 
                                                                            checked={!!data.supplements[supp.id]} 
                                                                            onChange={() => toggleSupplement(day, supp.id)}
                                                                            className="mt-0.5 w-4 h-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500"
                                                                        />
                                                                        <div className="leading-tight">
                                                                            <div className={`text-xs ${data.supplements[supp.id] ? 'text-slate-800 font-medium' : 'text-slate-500'}`}>{supp.name}</div>
                                                                            <div className="text-[10px] text-slate-400 font-mono">{supp.dosage}</div>
                                                                        </div>
                                                                    </label>
                                                                ))}
                                                            </div>
                                                        </td>

                                                        {/* Soir */}
                                                        <td className="px-3 py-4 align-top bg-indigo-50/20">
                                                            <div className="flex flex-col gap-3">
                                                                <label className="flex items-center gap-2 cursor-pointer select-none mb-1">
                                                                    <input 
                                                                        type="checkbox" 
                                                                        checked={data.repasOk.soir} 
                                                                        onChange={() => toggleRepas(day, 'soir')}
                                                                        className="w-4 h-4 rounded border-slate-300 text-emerald-600 focus:ring-emerald-500"
                                                                    />
                                                                    <Badge color={data.repasOk.soir ? 'green' : 'slate'}>Repas OK</Badge>
                                                                </label>
                                                                <div className="w-12 border-b border-slate-200 mx-auto opacity-50"></div>
                                                                {configSupplements.filter(s => s.time === 'soir').map(supp => (
                                                                    <label key={supp.id} className="flex items-start gap-2 cursor-pointer select-none group/item">
                                                                        <input 
                                                                            type="checkbox" 
                                                                            checked={!!data.supplements[supp.id]} 
                                                                            onChange={() => toggleSupplement(day, supp.id)}
                                                                            className="mt-0.5 w-4 h-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500"
                                                                        />
                                                                        <div className="leading-tight">
                                                                            <div className={`text-xs ${data.supplements[supp.id] ? 'text-slate-800 font-medium' : 'text-slate-500'}`}>{supp.name}</div>
                                                                            <div className="text-[10px] text-slate-400 font-mono">{supp.dosage}</div>
                                                                        </div>
                                                                    </label>
                                                                ))}
                                                            </div>
                                                        </td>

                                                        {/* MÃ©triques */}
                                                        <td className="px-4 py-4 border-l border-slate-100">
                                                            <div className="grid grid-cols-2 gap-2">
                                                                <div className="space-y-1">
                                                                    <label className="text-[10px] uppercase text-slate-400 font-bold">Ã‰nergie</label>
                                                                    <select 
                                                                        value={data.metrics.energie}
                                                                        onChange={(e) => updateMetric(day, 'energie', e.target.value)}
                                                                        className={`w-full text-xs p-1 rounded border border-slate-200 focus:ring-1 focus:ring-indigo-500 outline-none ${getMetricColor(data.metrics.energie)}`}
                                                                    >
                                                                        <option value="">-</option>
                                                                        {[...Array(11).keys()].map(n => <option key={n} value={n}>{n}</option>)}
                                                                    </select>
                                                                </div>
                                                                <div className="space-y-1">
                                                                    <label className="text-[10px] uppercase text-slate-400 font-bold">Moral</label>
                                                                    <select 
                                                                        value={data.metrics.moral}
                                                                        onChange={(e) => updateMetric(day, 'moral', e.target.value)}
                                                                        className={`w-full text-xs p-1 rounded border border-slate-200 focus:ring-1 focus:ring-indigo-500 outline-none ${getMetricColor(data.metrics.moral)}`}
                                                                    >
                                                                        <option value="">-</option>
                                                                        {[...Array(11).keys()].map(n => <option key={n} value={n}>{n}</option>)}
                                                                    </select>
                                                                </div>
                                                                <div className="space-y-1">
                                                                    <label className="text-[10px] uppercase text-slate-400 font-bold">Digestion</label>
                                                                    <select 
                                                                        value={data.metrics.digestion}
                                                                        onChange={(e) => updateMetric(day, 'digestion', e.target.value)}
                                                                        className={`w-full text-xs p-1 rounded border border-slate-200 focus:ring-1 focus:ring-indigo-500 outline-none ${getMetricColor(data.metrics.digestion)}`}
                                                                    >
                                                                        <option value="">-</option>
                                                                        {[...Array(11).keys()].map(n => <option key={n} value={n}>{n}</option>)}
                                                                    </select>
                                                                </div>
                                                                <div className="space-y-1">
                                                                    <label className="text-[10px] uppercase text-slate-400 font-bold">Selles</label>
                                                                    <select 
                                                                        value={data.metrics.selles}
                                                                        onChange={(e) => updateMetric(day, 'selles', e.target.value)}
                                                                        className={`w-full text-xs p-1 rounded border border-slate-200 focus:ring-1 focus:ring-indigo-500 outline-none ${getMetricColor(data.metrics.selles, 'selles')}`}
                                                                    >
                                                                        <option value="">-</option>
                                                                        {[1,2,3,4,5,6,7].map(n => <option key={n} value={n}>Type {n}</option>)}
                                                                    </select>
                                                                </div>
                                                            </div>
                                                        </td>

                                                        {/* Notes */}
                                                        <td className="px-4 py-4">
                                                            <textarea 
                                                                value={data.notes}
                                                                onChange={(e) => updateNote(day, e.target.value)}
                                                                placeholder="SymptÃ´mes..."
                                                                className="w-full h-20 text-xs p-2 rounded bg-slate-50 border border-slate-200 focus:bg-white focus:ring-1 focus:ring-indigo-500 outline-none resize-none transition-all"
                                                            />
                                                        </td>

                                                    </tr>
                                                );
                                            })}
                                        </tbody>
                                    </table>
                                </Card>

                                {/* Bilan Section */}
                                <div className="grid md:grid-cols-2 gap-6">
                                    <Card className="p-4">
                                        <h3 className="font-bold text-slate-700 mb-2 flex items-center gap-2 text-sm uppercase tracking-wide">
                                            <Icons.CheckCircle2 size={16} className="text-emerald-500"/>
                                            Victoires de la semaine
                                        </h3>
                                        <textarea 
                                            value={currentWeekData.review?.victories || ''}
                                            onChange={(e) => updateReview('victories', e.target.value)}
                                            className="w-full h-24 p-3 text-sm rounded bg-emerald-50/30 border border-slate-200 outline-none focus:ring-1 focus:ring-emerald-500 placeholder-slate-400"
                                            placeholder="Points positifs, Ã©nergie retrouvÃ©e..."
                                        />
                                    </Card>
                                    <Card className="p-4">
                                        <h3 className="font-bold text-slate-700 mb-2 flex items-center gap-2 text-sm uppercase tracking-wide">
                                            <Icons.AlertCircle size={16} className="text-amber-500"/>
                                            Ajustements Ã  prÃ©voir
                                        </h3>
                                        <textarea 
                                            value={currentWeekData.review?.adjustments || ''}
                                            onChange={(e) => updateReview('adjustments', e.target.value)}
                                            className="w-full h-24 p-3 text-sm rounded bg-amber-50/30 border border-slate-200 outline-none focus:ring-1 focus:ring-amber-500 placeholder-slate-400"
                                            placeholder="Que changer la semaine prochaine ?"
                                        />
                                    </Card>
                                </div>
                                
                                <div className="flex justify-end pt-4">
                                    <button 
                                        onClick={deleteCurrentWeek}
                                        className="text-xs text-rose-300 hover:text-rose-600 flex items-center gap-1 transition-colors"
                                    >
                                        <Icons.Trash2 size={12} /> Supprimer cette semaine
                                    </button>
                                </div>

                            </div>
                        )}

                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>